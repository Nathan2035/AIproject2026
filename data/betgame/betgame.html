<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>å°ç‘ªè‰è·‘ç‡ˆæ©Ÿå°</title>
<style>
body{margin:0;background:#fff;font-family:Arial;display:flex;flex-direction:column;align-items:center;position:relative;}
#container{border:4px solid black;padding:5px 10px 0px 10px;display:flex;flex-direction:column;align-items:center;margin-top:6px;}
#top{width:358px;display:flex;justify-content:space-between;margin:5px 0px 5px 0px;}
.panel{width:170px;background:#222;color:#0f0;border:4px solid gold;padding:6px;display:flex;flex-direction:column;align-items:center;}
.panel-title{font-size:18px;margin-bottom:4px;color:#fff;}
.digits{display:flex;gap:3px;}
.digit{width:26px;height:34px;background:#111;border:2px solid #555;display:flex;justify-content:center;align-items:center;color:#f00;font-weight:bold;font-size:26px;box-shadow:0 0 6px #f00,inset 0 0 4px #600;border-radius:4px;font-family:'Courier New',monospace;}
#game{position:relative;width:348px;height:348px;border:6px solid gold;background:#fff;margin-bottom:10px;}
#grid{width:100%;height:100%;display:grid;grid-template-columns:repeat(7,1fr);grid-template-rows:repeat(7,1fr);gap:1px;}
.cell{display:flex;justify-content:center;align-items:center;font-size:18px;position:relative;background:#fff;border:1px solid #000;}
.light{width:10px;height:10px;border-radius:50%;position:absolute;top:2px;right:2px;}
#center-frame{position:absolute;border:6px solid gold;width:240px;height:240px;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;}
#msg{
  position:absolute;
  top:calc(50% - 50px);
  left:50%;
  transform:translate(-50%,-50%);
  font-size:18px;
  font-weight:bold;
  pointer-events:none;
  width: 250px;
  text-align: center;
  white-space: nowrap;
}
#bets{margin:10px 0;display:flex;width:356px;justify-content:space-between;gap:4px;}
.bet{display:flex;flex-direction:column;align-items:center;width:45px;border:2px solid #000;padding:2px;box-sizing:border-box;}
.fixed-number{width:100%;height:18px;background:#ccc;border:1px solid #555;font-size:14px;font-weight:bold;display:flex;justify-content:center;align-items:center;margin-bottom:2px;font-family:'Courier New',monospace;}
.bet button{width:100%;height:25px;background:linear-gradient(#ffffff,#dcdcdc);color:#000;border:1px solid #666;border-radius:6px;cursor:pointer;font-weight:bold;font-size:11px;margin-bottom:4px;box-shadow:2px 2px 0 #bbb, inset 0 1px 0 #fff;transition:transform 0.05s, box-shadow 0.05s;}
.bet button:active{transform:translate(3px,3px);box-shadow:0 0 0 #666,inset 0 1px 0 #ccc;}
.bet .count{width:90%;height:20px;line-height:20px;text-align:center;background:#111;border:2px solid #555;color:#f00;font-weight:bold;font-size:18px;box-shadow:0 0 6px #f00,inset 0 0 4px #600;border-radius:3px;font-family:'Courier New',monospace;margin-top:2px;}
#button-area{display:flex; align-items:center; margin-bottom:10px;}
#button-area button{width:40px;height:38px;background:linear-gradient(#ffffff,#dcdcdc);color:#000;border:1px solid #666;border-radius:6px;cursor:pointer;font-size:12px;margin-left:25px;margin-bottom:-10px;box-shadow:2px 2px 0 #bbb, inset 0 1px 0 #fff;transition:transform 0.05s, box-shadow 0.05s;}
#button-area button:active{transform:translate(3px,3px);box-shadow:0 0 0 #666,inset 0 1px 0 #ccc;}
#button-area button#start { margin-left: 25px; }
#button-area button#func1 { margin-left: 0px; }
#button-area button#func2 { margin-left: 40px; }
#button-area button#func3 { margin-left:40px; }
#button-area button#cancel { margin-left:5px; }
#button-area button#func4 { margin-left:5px; }

#backBtn{position:fixed;top:10px;right:10px;padding:6px 12px;font-size:14px;background:#fff;border:2px solid #ccc;border-radius:6px;cursor:pointer;color:#333;z-index:9999;box-shadow:2px 2px 5px rgba(0,0,0,0.3);transition: all 0.1s ease;}
#backBtn:active{transform: translateY(2px);box-shadow:1px 1px 3px rgba(0,0,0,0.3);}
  #func1:disabled {
    background: #ddd !important; /* æ”¹è®ŠèƒŒæ™¯é¡è‰² */
    color: #888 !important;      /* æ”¹è®Šæ–‡å­—é¡è‰² */
    cursor: not-allowed !important;
    box-shadow: none !important; /* å»æ‰ç«‹é«”é™°å½±æ•ˆæœ */
}

</style>
</head>
<body>

<div id="top-right">
<button id="backBtn">å›åˆ°ä¸Šä¸€é </button>
<div id="version" style="position:fixed; top:50px; right:20px; font-size:14px; color:#333333;">ç‰ˆæœ¬: V0.06</div>
</div>

<div id="container">
  <div id="top">
    <div class="panel">
      <div class="panel-title">WIN</div>
      <div class="digits" id="win-digits"><div class="digit">0</div><div class="digit">0</div><div class="digit">0</div><div class="digit">0</div></div>
    </div>
    <div class="panel">
      <div class="panel-title">CREDIT</div>
      <div class="digits" id="credit-digits"><div class="digit">0</div><div class="digit">0</div><div class="digit">0</div><div class="digit">0</div></div>
    </div>
  </div>

  <div id="game">
    <div id="grid"></div>
    <div id="center-frame"></div>
    <div id="msg"></div>

    <div style="position:absolute; top:50%; left:40%; transform:translate(-50%,-50%); text-align:center;">
      <div id="center-left-light" class="light" style="background:#bbb; width:14px; height:14px;"></div>
      <div style="font-size:18px; color:#000; margin-top:15px;">å·¦</div>
    </div>

    <div style="position:absolute; top:50%; left:60%; transform:translate(-50%,-50%); text-align:center;">
      <div id="center-right-light" class="light" style="background:#bbb; width:14px; height:14px;"></div>
      <div style="font-size:18px; color:#000; margin-top:15px;">å³</div>
    </div>

    <div id="center-win-digits" style="position:absolute; top:calc(50% + 60px); left:50%; transform:translate(-50%,-50%); display:flex; gap:3px;">
      <div class="digit">0</div>
      <div class="digit">0</div>
      <div class="digit">0</div>
      <div class="digit">0</div>
    </div>
  </div>

  <div id="button-area">
    <button id="func1">æŠ•å¹£</button>
    <button id="func2">è½‰åˆ°éŒ¢åŒ…</button>
    <button id="func3">é¸å·¦</button>
    <button id="cancel">å–æ¶ˆ</button> 
    <button id="func4">é¸å³</button>
    <button id="start">é–‹å§‹</button>
  </div>

  <div id="bets"></div>
</div>

<script>
backBtn.onclick=()=>{window.history.back();};

// éŸ³æ•ˆè¨­å®š
const audioContext = new (window.AudioContext||window.webkitAudioContext)();
let coinBuffer = null;
fetch('coin07.mp3')
  .then(r => r.arrayBuffer())
  .then(b => audioContext.decodeAudioData(b))
  .then(buf => { coinBuffer = buf; });

function playCoin(){
  if(!coinBuffer) return;
  const source = audioContext.createBufferSource();
  source.buffer = coinBuffer;
  const gainNode = audioContext.createGain();
  gainNode.gain.value = 0.5;
  source.connect(gainNode).connect(audioContext.destination);
  source.start(0);
}

const grid=document.getElementById('grid'); 
const msg=document.getElementById('msg');
let credit=0, win=0;
let bets={}, betCounts={}; 
let spinning=false, pos=0;
let centerWin=0;
let flashingInterval=null;

const func1Btn = document.getElementById('func1');

function updateDigits(id,val){
  const s=val.toString().padStart(4,'0'); 
  const d=document.getElementById(id).children; 
  for(let i=0;i<4;i++) d[i].textContent=s[i];
}

function clearMsg() {
  msg.textContent = '';
}

// å»ºç«‹æ ¼å­
const letters=Array(7).fill(0).map(()=>Array(7).fill(''));
letters[0][0]='ğŸŠ';letters[6][6]='ğŸŠ'; letters[0][1]='ğŸ›ï¸'; letters[6][5]='ğŸ›ï¸';
letters[0][2]='ğŸ’'; letters[0][5]='ğŸ’'; letters[2][6]='ğŸ’'; letters[5][6]='ğŸ’';
letters[6][4]='ğŸ’';letters[6][1]='ğŸ’'; letters[4][0]='ğŸ’'; letters[1][0]='ğŸ’';
letters[0][3]='ğŸ€„'; letters[0][4]='ğŸ'; letters[2][0]='ğŸ'; letters[4][6]='ğŸ';
letters[6][2]='ğŸ'; letters[0][6]='ğŸ¥­'; letters[6][0]='ğŸ¥­'; letters[1][6]='ğŸ‰';
letters[6][3]='7ï¸âƒ£'; letters[5][0]='â­';letters[3][0]='ONCE MORE';letters[3][6]='ONCE MORE';

let cells=[]; 
for(let r=0;r<7;r++){
  for(let c=0;c<7;c++){
    const d=document.createElement('div'); 
    d.className='cell'; 
    d.dataset.letter=letters[r][c]; 
    d.textContent=letters[r][c];
    if(['ğŸŠ','ğŸ›ï¸','ğŸ’','ğŸ','ğŸ¥­','ğŸ‰','â­','ğŸ€„'].includes(letters[r][c])) d.style.fontSize='32px';
    if(letters[r][c]==='7ï¸âƒ£') d.style.fontSize='30px';
    if(letters[r][c]==='ONCE MORE') { 
      d.style.fontSize='12px'; 
      d.style.paddingLeft='2px'; 
    }
    const l=document.createElement('div'); 
    l.className='light';
    if(r>=1 && r<=5 && c>=1 && c<=5){
        d.dataset.center='true';
        d.style.border='1px solid #fff';
        d.style.color='#fff';
        l.style.background='#fff';
    } else { l.style.background='#bbb'; }
    d.appendChild(l); 
    grid.appendChild(d); 
    cells.push({el:d});
  }
}

let order=[]; for(let c=0;c<7;c++) order.push(cells[c]); for(let r=1;r<6;r++) order.push(cells[r*7+6]); for(let c=6;c>=0;c--) order.push(cells[6*7+c]); for(let r=5;r>0;r--) order.push(cells[r*7]);

const buttonConfig=[{ch:'ğŸ',mult:5},{ch:'ğŸ‰',mult:20},{ch:'â­',mult:30},{ch:'7ï¸âƒ£',mult:40},{ch:'ğŸ€„',mult:50},{ch:'ğŸ›ï¸',mult:20},{ch:'ğŸ¥­',mult:15},{ch:'ğŸŠ',mult:10},{ch:'ğŸ’',mult:2}];
const betBox=document.getElementById('bets');
buttonConfig.forEach(cfg=>{
  bets[cfg.ch]=0; betCounts[cfg.ch]=0;
  const wrap=document.createElement('div'); wrap.className='bet';
  const fixed=document.createElement('div'); fixed.className='fixed-number'; fixed.textContent=cfg.mult;
  const btn=document.createElement('button'); btn.textContent=cfg.ch;
  const count=document.createElement('div'); count.className='count'; count.textContent='0';
  btn.onclick=()=>{ 
    clearMsg();
    if(spinning) return;
    if(betCounts[cfg.ch]>=9) return; 
    if(credit <= 0){ msg.style.color = '#f00'; msg.textContent = 'è«‹å…ˆæŠ•å¹£æˆ–å°‡çé‡‘è½‰åˆ°éŒ¢åŒ…'; return; }
    betCounts[cfg.ch]++; bets[cfg.ch]++; credit--; count.textContent=betCounts[cfg.ch]; updateDigits('credit-digits', credit);
    playCoin();
    win += centerWin; updateDigits('win-digits', win);
    if(flashingInterval){ clearInterval(flashingInterval); flashingInterval = null; document.getElementById('center-left-light').style.background = '#bbb'; document.getElementById('center-right-light').style.background = '#bbb'; }
    centerWin = 0; updateDigits('center-win-digits', centerWin);
  };
  wrap.append(fixed,btn,count); betBox.appendChild(wrap);
});

// æŠ•å¹£æŒ‰éˆ•ä¿®æ”¹ï¼šé»æ“Šä¸€æ¬¡ç¦ç”¨
func1Btn.onclick = () => { 
  clearMsg(); 
  credit += 100; 
  updateDigits('credit-digits', credit); 
  playCoin(); 
  func1Btn.disabled = true; 
  
};

document.getElementById('func2').onclick = () => { 
  clearMsg(); 
  credit += win; win=0; 
  updateDigits('credit-digits', credit); 
  updateDigits('win-digits', win); 
};

function enableFunc1IfZero(){
  if(win === 0 && credit === 0 && centerWin === 0 && Object.values(betCounts).every(v => v===0)){
    func1Btn.disabled = false;
  
  }
}

function spin(){
  if(spinning) return;
  spinning=true;
  const minDelay=50; const maxDelay=300;
  const totalSteps = order.length*4 + Math.floor(Math.random()*order.length);
  let step=0; 
  const accelSteps = totalSteps*0.25; 
  const decelSteps = totalSteps*0.25;

  function nextStep(){
    order.forEach((o,idx)=>{
      const l=o.el.querySelector('.light');
      if(o.el.dataset.center) l.style.background='#fff';
      else l.style.background=idx===pos?'#f00':'#bbb';
    });
    playCoin();
    step++;
    if(step>=totalSteps){
      const stop = order[pos];
      const letter = stop.el.dataset.letter;

      if(letter === 'ONCE MORE'){
        spinning = false;
        setTimeout(() => { spin(); }, 1500);
        return;
      }

      const cfg = buttonConfig.find(b=>b.ch===letter);
      const gain = cfg?bets[letter]*cfg.mult:0;

      if(gain>0){
        centerWin = gain; updateDigits('center-win-digits', centerWin);
        msg.style.color='#f00'; 
        msg.style.whiteSpace = "pre-line";
        msg.textContent=`æŠ¼ä¸­${letter} çé‡‘${gain}å…ƒ\nå¯é¸å·¦å³é‚Š,çé‡‘åŠ å€`;

        const leftLight = document.getElementById('center-left-light');
        const rightLight = document.getElementById('center-right-light');
        let onLeft = true;
        flashingInterval = setInterval(()=>{
          playCoin();
          if(onLeft){ leftLight.style.background='#f00'; rightLight.style.background='#bbb'; }
          else { leftLight.style.background='#bbb'; rightLight.style.background='#f00'; }
          onLeft = !onLeft;
        }, 300);

      } else { centerWin=0; updateDigits('center-win-digits', centerWin); msg.style.color='#f00'; msg.textContent='æ²’æœ‰æŠ¼ä¸­'; }

      document.querySelectorAll('.count').forEach(c=>c.textContent='0'); 
      for(let k in bets){bets[k]=0; betCounts[k]=0;} 
      document.getElementById('start').disabled = true;
      setTimeout(()=>{document.getElementById('start').disabled=false; enableFunc1IfZero();},5000);
      spinning=false;
      return;
    }

    let currentDelay;
    if(step<accelSteps){ currentDelay = maxDelay - (maxDelay-minDelay)*(step/accelSteps); } 
    else if(step>totalSteps-decelSteps){ const s = step-(totalSteps-decelSteps); currentDelay = minDelay + (maxDelay-minDelay)*(s/decelSteps); } 
    else { currentDelay = minDelay; }

    pos = (pos+1)%order.length;
    setTimeout(nextStep,currentDelay);
  }
  nextStep();
}

document.getElementById('cancel').onclick = () => {
    clearMsg();
    if(centerWin > 0){
        win += centerWin; 
        updateDigits('win-digits', win);
        centerWin = 0; 
        updateDigits('center-win-digits', centerWin);
        if(flashingInterval){ 
            clearInterval(flashingInterval); 
            flashingInterval = null; 
            document.getElementById('center-left-light').style.background = '#bbb'; 
            document.getElementById('center-right-light').style.background = '#bbb'; 
        }
        msg.style.color = '#f00';
        msg.textContent = 'å·²æ”¾æ£„é¸é‚Šè´é›™å€çé‡‘';
        enableFunc1IfZero();
    }
};  
  

document.getElementById('start').onclick = () => { 
  clearMsg();
  if(spinning) return; 
  if(Object.values(bets).every(v => v === 0)){
    msg.style.color = '#f00';
    msg.textContent = 'è«‹å…ˆæŠ¼æ³¨';
    return;
  }
  spin(); 
};

function stopFlashing(selected){
  if(!flashingInterval) return;
  clearInterval(flashingInterval);
  flashingInterval=null;

  const leftLight = document.getElementById('center-left-light');
  const rightLight = document.getElementById('center-right-light');

  let finalSide = Math.random()<0.5?'left':'right';
  let steps = 6;
  let count=0;

  function slowStep(){
    if(count>=steps){
      leftLight.style.background = finalSide==='left'?'#f00':'#bbb';
      rightLight.style.background = finalSide==='right'?'#f00':'#bbb';

      if(finalSide===selected){
        centerWin *=2;
        updateDigits('center-win-digits', centerWin);
        msg.style.color='#f00';
        msg.textContent=`æ­å–œä½ ! çé‡‘ x2`;

        let onLeft = true;
        flashingInterval = setInterval(()=>{
          playCoin();
          if(onLeft){ leftLight.style.background='#f00'; rightLight.style.background='#bbb'; }
          else { leftLight.style.background='#bbb'; rightLight.style.background='#f00'; }
          onLeft = !onLeft;
        }, 300);

      } else { centerWin=0; updateDigits('center-win-digits', centerWin); msg.style.color='#f00'; msg.textContent=`é¸éŒ¯é‚Šäº†, çé‡‘æ­¸é›¶`; }

      enableFunc1IfZero();
      return;
    }
    if(count%2===0){ leftLight.style.background='#f00'; rightLight.style.background='#bbb'; }
    else{ leftLight.style.background='#bbb'; rightLight.style.background='#f00'; }
    playCoin();
    count++;
    setTimeout(slowStep,200);
  }
  slowStep();
}

document.getElementById('func3').onclick=()=>{ clearMsg(); stopFlashing('left'); }
document.getElementById('func4').onclick=()=>{ clearMsg(); stopFlashing('right'); }
//ç‰ˆæ¬Šå®£å‘Š : ç¨‹å¼å¯ä»¥å…è²»ä½¿ç”¨, ä½†ä¸èƒ½æœ‰ç‡Ÿåˆ©çš„ç”¨é€” Nathan
</script>

</body>
</html>
